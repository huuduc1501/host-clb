(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{79:function(e,t,n){},80:function(e,t,n){},81:function(e,t,n){"use strict";n.r(t);var c,a=n(0),s=n.n(a),r=n(29),i=n.n(r),o=n(4),l=n(12),d=n(17),u=n(5),j=n.n(u),b=n(14),m=n(11),f=n(16),p=n.n(f);p.a.defaults.baseURL="https://demo-clb-123.herokuapp.com/api/v1";var h=Object(m.b)("auth/signup",function(){var e=Object(b.a)(j.a.mark((function e(t){var n,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.post("/auth/signup",t,{withCredentials:!0});case 2:return n=e.sent,c=n.data.success,e.abrupt("return",c);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),O=Object(m.b)("auth/signin",function(){var e=Object(b.a)(j.a.mark((function e(t){var n,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.post("/auth/signin",t,{withCredentials:!0});case 2:return n=e.sent,c=n.data.success,e.abrupt("return",c);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var v=Object(m.c)({name:"auth",initialState:{loading:!0,isAuth:!1,hasToken:function(){console.log("check token");var e={},t=document.cookie;return t&&t.split(";").forEach((function(t){var n=t.split("=");e[n.shift().trim()]=n.join("=")})),!!e.token}()},reducers:{},extraReducers:(c={},Object(d.a)(c,h.fulfilled,(function(e,t){e.loading=!1,e.hasToken=t.payload})),Object(d.a)(c,O.fulfilled,(function(e,t){e.loading=!1,e.hasToken=t.payload})),c)}).reducer,x=n(1),g=function(e){var t=e.changeToSignup,n=Object(o.b)();return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("div",{className:"main order-md-1",children:Object(x.jsx)("div",{className:"start",children:Object(x.jsx)("div",{className:"container",children:Object(x.jsx)("div",{className:"col-md-12",children:Object(x.jsxs)("div",{className:"content",children:[Object(x.jsx)("h1",{children:"Sign in to Swipe"}),Object(x.jsx)("p",{children:"use your email account:"}),Object(x.jsxs)("form",{onSubmit:function(e){e.preventDefault(),n(O({email:e.target.email.value,password:e.target.password.value}))},children:[Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsx)("input",{type:"email",id:"inputEmail",className:"form-control",name:"email",placeholder:"Email Address",required:!0}),Object(x.jsx)("button",{className:"btn icon",children:Object(x.jsx)("i",{className:"material-icons",children:"mail_outline"})})]}),Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsx)("input",{type:"password",id:"inputPassword",className:"form-control",name:"password",placeholder:"Password",required:!0}),Object(x.jsx)("button",{className:"btn icon",children:Object(x.jsx)("i",{className:"material-icons",children:"lock_outline"})})]}),Object(x.jsx)("button",{type:"submit",className:"btn button",children:"Sign In"}),Object(x.jsx)("div",{className:"callout",children:Object(x.jsxs)("span",{children:["Don't have account? ",Object(x.jsx)("a",{href:"sign-up.html",children:"Create Account"})]})})]})]})})})})}),Object(x.jsx)("div",{className:"aside order-md-2",children:Object(x.jsx)("div",{className:"container",children:Object(x.jsx)("div",{className:"col-md-12",children:Object(x.jsxs)("div",{className:"preference",children:[Object(x.jsx)("h2",{children:"Hello, Friend!"}),Object(x.jsx)("p",{children:"Enter your personal details and start your journey with Swipe today."}),Object(x.jsx)("button",{onClick:t,className:"btn button",children:"Sign Up"})]})})})})]})},N=function(e){var t=e.changeToSignin,n=Object(o.b)();return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("div",{className:"main order-md-2",children:Object(x.jsx)("div",{className:"start",children:Object(x.jsx)("div",{className:"container",children:Object(x.jsx)("div",{className:"col-md-12",children:Object(x.jsxs)("div",{className:"content",children:[Object(x.jsx)("h1",{children:"Create Account"}),Object(x.jsx)("p",{children:"use your email for registration:"}),Object(x.jsxs)("form",{className:"signup",onSubmit:function(e){e.preventDefault(),n(h({email:e.target.email.value,password:e.target.password.value,fullname:e.target.fullname.value}))},children:[Object(x.jsxs)("div",{className:"form-parent",children:[Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsx)("input",{type:"text",id:"inputName",className:"form-control",name:"fullname",placeholder:"Username",required:!0}),Object(x.jsx)("button",{className:"btn icon",children:Object(x.jsx)("i",{className:"material-icons",children:"person_outline"})})]}),Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsx)("input",{type:"email",id:"inputEmail",className:"form-control",name:"email",placeholder:"Email Address",required:!0}),Object(x.jsx)("button",{className:"btn icon",children:Object(x.jsx)("i",{className:"material-icons",children:"mail_outline"})})]})]}),Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsx)("input",{type:"password",id:"inputPassword",className:"form-control",name:"password",placeholder:"Password",required:!0}),Object(x.jsx)("button",{className:"btn icon",children:Object(x.jsx)("i",{className:"material-icons",children:"lock_outline"})})]}),Object(x.jsx)("button",{type:"submit",className:"btn button",children:"Sign Up"}),Object(x.jsx)("div",{className:"callout",children:Object(x.jsxs)("span",{children:["Already a member? ",Object(x.jsx)("a",{href:"sign-in.html",children:"Sign In"})]})})]})]})})})})}),Object(x.jsx)("div",{className:"aside order-md-1",children:Object(x.jsx)("div",{className:"container",children:Object(x.jsx)("div",{className:"col-md-12",children:Object(x.jsxs)("div",{className:"preference",children:[Object(x.jsx)("h2",{children:"Welcome Back!"}),Object(x.jsx)("p",{children:"To keep connected with your friends please login with your personal info."}),Object(x.jsx)("button",{onClick:t,className:"btn button",children:"Sign In"})]})})})})]})},y=function(){var e=Object(a.useState)("signin"),t=Object(l.a)(e,2),n=t[0],c=t[1];return Object(x.jsx)(x.Fragment,{children:"signin"===n?Object(x.jsx)(g,{changeToSignup:function(){return c("signup")}}):Object(x.jsx)(N,{changeToSignin:function(){return c("signin")}})})},k=Object(a.createContext)(null),w=function(e){var t=e.children,n=Object(a.useState)(null),c=Object(l.a)(n,2),s=c[0],r=c[1];return Object(a.useEffect)((function(){try{var e=new WebSocket("wss://demo-clb-123.herokuapp.com");r(e)}catch(t){console.log(t)}}),[]),Object(x.jsx)(k.Provider,{value:s,children:t})},_=n(48),C=n(18),S=n(19),E=function(){var e=Object(a.useContext)(k);if(void 0===e)throw new Error("faillllllllllllll websocket");return[e,function(e,t){return JSON.stringify({type:e,payload:t})}]};p.a.defaults.baseURL="https://demo-clb-123.herokuapp.com/api/v1";var I,T,L=Object(m.b)("chat/messages",function(){var e=Object(b.a)(j.a.mark((function e(t){var n,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.get("/conversation/".concat(t,"/message"),{withCredentials:!0});case 2:return n=e.sent,c=n.data.messages,e.abrupt("return",{key:t,value:c});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),R=Object(m.c)({name:"chat",initialState:{isLoading:!0,chats:{}},reducers:{addMessage:function(e,t){var n;null===(n=e.chats[t.payload.conversationId])||void 0===n||n.push(t.payload)}},extraReducers:Object(d.a)({},L.fulfilled,(function(e,t){e.isLoading=!1,e.chats[t.payload.key]=t.payload.value}))}),D=R.actions.addMessage,M=R.reducer,A=function(e){var t=e.user;return Object(x.jsxs)("div",{className:"message",children:[Object(x.jsx)("img",{className:"avatar-md",src:t.avatar,"data-toggle":"tooltip","data-placement":"top",title:"Keith",alt:"avatar"}),Object(x.jsx)("div",{className:"text-main",children:Object(x.jsx)("div",{className:"text-group",children:Object(x.jsx)("div",{className:"text typing",children:Object(x.jsxs)("div",{className:"wave",children:[Object(x.jsx)("span",{className:"dot"}),Object(x.jsx)("span",{className:"dot"}),Object(x.jsx)("span",{className:"dot"})]})})})})]})},F=function(e){var t=e.message,n=new Date(t.createdAt);return Object(x.jsxs)("div",{className:"message ".concat(t.isMine?"me":""),children:[t.isMine?"":Object(x.jsx)("img",{className:"avatar-md",src:t.senderId.avatar,"data-toggle":"tooltip","data-placement":"top",title:"Keith",alt:"avatar"}),Object(x.jsxs)("div",{className:"text-main",children:[Object(x.jsx)("div",{className:"text-group ".concat(t.isMine?"me":""),children:Object(x.jsx)("div",{className:"text ".concat(t.isMine?"me":""),children:Object(x.jsx)("p",{children:t.message})})}),Object(x.jsx)("span",{children:"".concat(n.getHours(),":").concat(n.getMinutes())})]})]})},U=Object(m.c)({name:"call",initialState:{conversation:null,isCalling:!1,incommingCall:!1,callAway:!1},reducers:{setConversation:function(e,t){e.conversation=t.payload,e.isCalling=!0},setIncommingCall:function(e,t){e.incommingCall=!0,e.isCalling=!0},setCallAway:function(e,t){e.callAway=!0,e.isCalling=!0},setIsCallingToFalse:function(e,t){e.isCalling=e.incommingCall=e.callAway=!1,e.conversation=null}}}),P=U.actions,J=P.setConversation,z=P.setIncommingCall,V=P.setCallAway,q=P.setIsCallingToFalse,K=U.reducer,B=n(43),H=n(47),W=(n(78),S.a.div(I||(I=Object(C.a)(["\n  position: relative;\n\n  .emoji__picker--toggle {\n  }\n  .emoji__picker--content {\n    display: none;\n  }\n  .active {\n    display: block;\n  }\n  @media (max-width: 425px) {\n    .emoji-mart {\n      width: 280px !important;\n    }\n  }\n\n"])))),G=s.a.forwardRef((function(e,t){var n=e.setValue,c=e.pickerStyle,s=Object(a.useRef)(null);Object(a.useEffect)((function(){!function(e,t){document.addEventListener("mousedown",(function(n){t.current&&t.current.contains(n.target)?e.current.classList.toggle("active"):e.current&&!e.current.contains(n.target)&&e.current.classList.remove("active")}))}(s,t)}),[t]);return Object(x.jsxs)(W,{children:[Object(x.jsx)("div",{ref:t,className:"emoji__picker--toggle",children:Object(x.jsx)("i",{className:"material-icons",style:{padding:"14px"},children:"insert_emoticon"})}),Object(x.jsx)("div",{ref:s,className:"emoji__picker--content",children:Object(x.jsx)(H.a,{set:"apple",style:Object(B.a)({position:"absolute",zIndex:"9"},c),onSelect:function(e){n((function(t){return t+e.native}))}})})]})})),Q=(S.a.div(T||(T=Object(C.a)(["\n    position: fixed;\n    /* width: 200px;\n    height: 200px; */\n    z-index:9999999;\n    background:linear-gradient(145deg,rgba(140,167,255,1) 0,rgba(139,84,249,1) 50%,rgba(131,33,243,1) 100%);\n"]))),function(){var e,t=Object(o.c)((function(e){return e.chat})),n=t.isLoading,c=t.chats,s=Object(o.c)((function(e){return e.conversations})).currentConversation,r=Object(a.useState)(""),i=Object(l.a)(r,2),d=i[0],u=i[1],j=Object(a.useState)([]),b=Object(l.a)(j,2),m=b[0],f=b[1],p=Object(o.c)((function(e){return e.call})).isCalling,h=E(),O=Object(l.a)(h,2),v=O[0],g=O[1],N=Object(o.b)(),y=Object(a.useRef)(""),k=Object(a.useRef)(),w=Object(a.useRef)(),C=Object(a.useRef)();Object(a.useEffect)((function(){""===y.current&&""!==d&&v.send(g("start-typing",{conversationId:s._id})),""===d&&""!==y.current&&v.send(g("end-typing",{conversationId:s._id})),y.current!==d&&(y.current=d)}),[s._id,d,v,g]),Object(a.useEffect)((function(){return function(){d&&(u(""),v&&v.send(g("end-typing",{conversationId:s._id})))}}),[s._id]),Object(a.useEffect)((function(){v&&v.addEventListener("message",(function(e){var t=e.data;if((t=JSON.parse(t)).conversationId===s._id)switch(t.type){case"start-typing":f((function(e){return[].concat(Object(_.a)(e),[t.payload.user])}));break;case"end-typing":f((function(e){return e.filter((function(e){return e._id!==t.payload.user._id}))}));break;default:return}}))}),[v,s._id]),Object(a.useEffect)((function(){k.current&&(k.current.scrollTop=w.current.offsetHeight)}),[c]),Object(a.useEffect)((function(){!c[s._id]&&s._id&&N(L(s._id))}),[c,s._id,N]);var S=function(e){if(d.trim()){u("");var t={type:"text",message:d,conversationId:s._id,createdAt:(new Date).toISOString()};v.send(g("new-message",t)),t.isMine=!0,N(D(t))}};return!c[s._id]||n?null:Object(x.jsx)(x.Fragment,{children:Object(x.jsx)("div",{className:"main",children:Object(x.jsx)("div",{className:"tab-content",id:"nav-tabContent",children:Object(x.jsx)("div",{className:"babble tab-pane fade active show",id:"list-chat",role:"tabpanel","aria-labelledby":"list-chat-list",children:Object(x.jsxs)("div",{className:"chat",id:"chat1",children:[Object(x.jsx)("div",{className:"top",children:Object(x.jsx)("div",{className:"container",children:Object(x.jsx)("div",{className:"col-md-12",children:Object(x.jsxs)("div",{className:"inside",children:[Object(x.jsx)("a",{href:"/",onClick:function(e){return e.preventDefault()},children:Object(x.jsx)("img",{className:"avatar-md",src:s.avatar,"data-toggle":"tooltip","data-placement":"top",title:"Keith",alt:"avatar"})}),Object(x.jsx)("div",{className:"status",children:Object(x.jsx)("i",{className:"material-icons online",children:"fiber_manual_record"})}),Object(x.jsxs)("div",{className:"data",children:[Object(x.jsx)("h5",{children:Object(x.jsx)("a",{href:"/",onClick:function(e){return e.preventDefault()},children:s.title})}),Object(x.jsx)("span",{children:"Active now"})]}),Object(x.jsx)("button",{className:"btn connect d-md-block d-none",name:1,onClick:function(){p||(N(V(!0)),N(J(s)))},children:Object(x.jsx)("i",{className:"material-icons md-36",children:"videocam"})})]})})})}),Object(x.jsx)("div",{ref:k,className:"content",id:"content",children:Object(x.jsx)("div",{ref:w,className:"container",children:Object(x.jsxs)("div",{className:"col-md-12",children:[null===(e=c[s._id])||void 0===e?void 0:e.map((function(e,t){return Object(x.jsx)(F,{message:e},e._id||t)})),null===m||void 0===m?void 0:m.map((function(e,t){return Object(x.jsx)(A,{user:e},t)}))]})})}),Object(x.jsx)("div",{className:"container",children:Object(x.jsx)("div",{className:"col-md-12",children:Object(x.jsx)("div",{className:"bottom",children:Object(x.jsxs)("form",{className:"position-relative w-100",children:[Object(x.jsx)("textarea",{className:"form-control",placeholder:"Start typing for reply...",rows:1,value:d,onChange:function(e){return u(e.target.value)},onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),S())}}),Object(x.jsx)("div",{style:{padding:0},className:"btn emoticons",onClick:function(e){e.preventDefault(),C.current.dispatchEvent(new Event("mousedown"))},children:Object(x.jsx)(G,{ref:C,setValue:u,pickerStyle:{left:0,bottom:"50px"}})}),Object(x.jsx)("button",{type:"button",className:"btn send",onClick:S,children:Object(x.jsx)("i",{className:"material-icons",children:"send"})})]})})})})]})})})})})});p.a.defaults.baseURL="https://demo-clb-123.herokuapp.com/api/v1";var X,Y,Z,$,ee=Object(m.b)("conversations/list",Object(b.a)(j.a.mark((function e(){var t,n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.get("/conversation",{withCredentials:!0});case 2:return t=e.sent,n=t.data.conversations,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))),te=Object(m.c)({name:"conversations",initialState:{isLoading:!0,currentConversation:"",conversations:[]},reducers:{chooseConversation:function(e,t){e.currentConversation=e.conversations.find((function(e){return e._id===t.payload}))},setLastMessage:function(e,t){e.conversations.forEach((function(e){e._id===t.payload.conversationId&&(e.lastMessageId=t.payload)}))}},extraReducers:Object(d.a)({},ee.fulfilled,(function(e,t){e.isLoading=!1,e.conversations=t.payload}))}),ne=te.actions,ce=ne.chooseConversation,ae=ne.setLastMessage,se=te.reducer,re=(S.a.div(X||(X=Object(C.a)(["\n    height: 80px;\n    width:100%;\n"]))),["Mon","Tue","Wed","Thurs","Fri","Sat","Sun"]),ie=function(e){var t=e.cvs,n=Object(o.b)();return Object(x.jsxs)("a",{onClick:function(e){e.preventDefault(),n(L(t._id)),n(ce(t._id))},href:"#list-chat",className:"filterDiscussions all unread single active",id:"list-chat-list","data-toggle":"list",role:"tab",children:[Object(x.jsx)("img",{className:"avatar-md",src:t.avatar,"data-toggle":"tooltip","data-placement":"top",title:"Janette",alt:"avatar"}),Object(x.jsx)("div",{className:"status",children:Object(x.jsx)("i",{className:"material-icons online",children:"fiber_manual_record"})}),Object(x.jsxs)("div",{className:"data",children:[Object(x.jsx)("h5",{children:t.title}),Object(x.jsx)("span",{children:re[new Date(t.lastMessageId.createdAt).getDay()]}),Object(x.jsx)("p",{children:t.lastMessageId.message})]})]})},oe=(S.a.div(Y||(Y=Object(C.a)(["\n    border: 1px solid black;\n"]))),function(){var e=Object(o.c)((function(e){return e.conversations})),t=e.isLoading,n=e.conversations,c=Object(o.b)(),s=E(),r=Object(l.a)(s,2),i=r[0];r[1];Object(a.useEffect)((function(){i&&i.addEventListener("message",(function(e){var t=e.data;"new-message"===(t=JSON.parse(t)).type&&(c(ae(t.payload.message)),t.payload.message.isMine||c(D(t.payload.message)))}))}),[i,c]),Object(a.useEffect)((function(){c(ee())}),[c]);return t?"...loading":Object(x.jsx)(x.Fragment,{children:Object(x.jsx)("div",{className:"sidebar",id:"sidebar",children:Object(x.jsx)("div",{className:"container",children:Object(x.jsx)("div",{className:"col-md-12",children:Object(x.jsx)("div",{className:"tab-content",children:Object(x.jsx)("div",{id:"discussions",className:"tab-pane fade active show",children:Object(x.jsxs)("div",{className:"discussions",children:[Object(x.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[Object(x.jsx)("h1",{children:"Discussions"}),Object(x.jsx)("button",{className:"btn btn-outline-danger",onClick:function(){document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",c({type:"LOGOUT"})},children:Object(x.jsx)("i",{className:"material-icons md-30",children:"power_settings_new"})})]}),Object(x.jsx)("div",{className:"list-group",id:"chats",role:"tablist",children:null===n||void 0===n?void 0:n.map((function(e){return Object(x.jsx)(ie,{cvs:e},e._id)}))})]})})})})})})})}),le=n(32),de=S.a.div(Z||(Z=Object(C.a)(["\n    position: fixed;\n    width: 390px;\n    height: 300px;\n    z-index: 9999999;\n    top: 100px;\n\n    right: 0;\n\n    background-color: aliceblue;\n    filter: white;\n    .hover__inner {\n        opacity: 0;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n    }\n    .call-end {\n        color: red;\n    }\n    .pick-up {\n        color: green;\n    }\n    :hover .hover__inner {\n        position: absolute;\n        width: 390px;\n        height: 300px;\n        z-index: 99999999;\n        opacity: 1;\n    }\n    .relative {\n        position: relative;\n    }\n\n    #local__video {\n        position: absolute;\n        width: 130px;\n        height: 100px;\n        /* border: 1px solid black; */\n        z-index: 99999990;\n    }\n    #remote__video {\n        position: absolute;\n        width: 390px;\n        height: 300px;\n        /* border: 1px solid black; */\n        /* z-index: 99999999; */\n    }\n"]))),ue=!1,je=S.a.div($||($=Object(C.a)(["\n    position: absolute;\n    display: flex;\n    left: -50px;\n"]))),be=function(e){var t=e.setVolume;return Object(x.jsxs)(je,{children:[Object(x.jsx)("i",{className:"material-icons md-30",children:"volume_down"}),Object(x.jsx)("input",{type:"range",min:"0",max:"100",defaultValue:"100",id:"myRange",onChange:t}),Object(x.jsx)("i",{className:"material-icons md-30",children:"volume_up"})]})},me=function(){var e=E(),t=Object(l.a)(e,2),n=t[0],c=t[1],s=Object(a.useRef)(),r=Object(a.useRef)(),i=Object(a.useRef)(null),d=Object(a.useRef)(null),u=Object(o.c)((function(e){return e.call})),m=u.conversation,f=u.incommingCall,p=u.callAway,h=Object(a.useState)(!0),O=Object(l.a)(h,2),v=O[0],g=O[1],N=Object(o.b)(),y=Object(a.useState)(!0),k=Object(l.a)(y,2),w=k[0],_=k[1],C=Object(a.useState)(!0),S=Object(l.a)(C,2),I=S[0],T=S[1],L=Object(a.useState)(!1),R=Object(l.a)(L,2),D=R[0],M=R[1],A=Object(a.useRef)(p),F=Object(a.useRef)(!1);function U(){i.current=new RTCPeerConnection({iceServers:[{urls:"stun:stun2.1.google.com:19302"}]}),i.current.onicecandidate=V,i.current.onnegotiationneeded=B,i.current.ontrack=W}Object(a.useEffect)((function(){var e=!1,t=function(){var t=Object(b.a)(j.a.mark((function t(a){var s,r,o,l,u,b,f,p,h,O;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s=a.data;try{s=JSON.parse(s)}catch(j){}if(o=(r=s).type,l=r.payload,u=l.description,b=l.candidate,"signaling"!==o){t.next=35;break}if(t.prev=4,console.log("type: "+(b?"candidate":u.type)),!F.current){F.current=!0,f=Object(le.a)(d.current.getTracks());try{for(f.s();!(p=f.n()).done;)h=p.value,i.current.addTrack(h,d.current)}catch(v){f.e(v)}finally{f.f()}}if(!u){t.next=20;break}if(O="offer"===u.type&&(ue||"stable"!==i.current.signalingState),!(e=!A&&O)){t.next=12;break}return t.abrupt("return");case 12:return t.next=14,i.current.setRemoteDescription(u);case 14:if("offer"!==u.type){t.next=18;break}return t.next=17,i.current.setLocalDescription();case 17:n.send(c("signaling",{description:i.current.localDescription,conversationId:m._id}));case 18:t.next=30;break;case 20:if(!b){t.next=30;break}return t.prev=21,t.next=24,i.current.addIceCandidate(b);case 24:t.next=30;break;case 26:if(t.prev=26,t.t0=t.catch(21),e){t.next=30;break}throw t.t0;case 30:t.next=35;break;case 32:t.prev=32,t.t1=t.catch(4),console.error(t.t1);case 35:"leave"===o&&P();case 36:case"end":return t.stop()}}),t,null,[[4,32],[21,26]])})));return function(e){return t.apply(this,arguments)}}();return n&&n.addEventListener("message",t),function(){n&&n.removeEventListener("message",t)}}),[n]),Object(a.useEffect)((function(){p&&(U(),z({video:!0,audio:!0}).then((function(){console.log("make call"),n.send(c("make-call",{conversationId:m._id})),r.current||n.send(c("leave",{conversationId:m._id}))})))}),[n,p]),Object(a.useEffect)((function(){return function(){console.log("leavee"),K(),n.send(c("leave",{conversationId:m._id}))}}),[]);var P=function(){K()},J=function(){var e=Object(b.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("pickup"),g(!1),U(),z({video:!0,audio:!0}).then((function(){F.current=!0;var e,t=Object(le.a)(d.current.getTracks());try{for(t.s();!(e=t.n()).done;){var a=e.value;i.current.addTrack(a,d.current)}}catch(s){t.e(s)}finally{t.f()}r.current||n.send(c("leave",{conversationId:m._id}))}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=Object(b.a)(j.a.mark((function e(t){var n,c,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.video,c=t.audio,e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({video:n,audio:c});case 4:a=e.sent,d.current=a,s.current?s.current.srcObject=a:(console.log("leave callllllllllllllllllll"),d.current.getTracks().forEach((function(e){return e.stop()}))),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),G(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),V=function(e){e.candidate&&n.send(c("signaling",{conversationId:m._id,candidate:e.candidate}))};function K(){N(q()),d.current&&d.current.getTracks().forEach((function(e){e.stop()})),i.current&&(i.current.ontrack=null,i.current.onnicecandidate=null,i.current.oniceconnectionstatechange=null,i.current.onsignalingstatechange=null,i.current.onicegatheringstatechange=null,i.current.onnotificationneeded=null,i.current.getTransceivers().forEach((function(e){e.stop()})),i.current.close(),i.current=null,d.current=null)}function B(){return H.apply(this,arguments)}function H(){return(H=Object(b.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,ue=!0,e.next=4,i.current.setLocalDescription();case 4:n.send(c("signaling",{description:i.current.localDescription,conversationId:m._id})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:return e.prev=10,ue=!1,e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[0,7,10,13]])})))).apply(this,arguments)}function W(e){var t=e.track,n=e.streams;t.onunmute=function(){r.current.srcObject||(r.current.srcObject=n[0])}}function G(e){switch(console.error(e),e.name){case"NotFoundError":alert("Unable to open your call because no camera and/or microphonewere found.");break;case"SecurityError":case"PermissionDeniedError":break;default:alert("Error opening your camera and/or microphone: "+e.message)}K()}return Object(x.jsxs)(de,{children:[Object(x.jsx)("video",{ref:s,autoPlay:!0,id:"local__video",muted:!0}),Object(x.jsx)("video",{ref:r,autoPlay:!0,id:"remote__video"}),Object(x.jsx)("div",{className:"hover__inner",children:Object(x.jsxs)("div",{className:"options",children:[Object(x.jsx)("button",{className:"btn option",onClick:function(){d.current&&(d.current.getAudioTracks().forEach((function(e){return e.enabled=!w})),_(!w))},children:w?Object(x.jsx)("i",{className:"material-icons md-30",children:"mic"}):Object(x.jsx)("i",{className:"material-icons md-30",children:"mic_off"})}),Object(x.jsx)("button",{className:"btn option",onClick:function(){d.current&&(d.current.getVideoTracks().forEach((function(e){return e.enabled=!I})),T(!I))},children:I?Object(x.jsx)("i",{className:"material-icons md-30",children:"videocam"}):Object(x.jsx)("i",{className:"material-icons md-30",children:"videocam_off"})}),f&&v&&Object(x.jsx)("button",{className:"btn pick-up",onClick:J,children:Object(x.jsx)("i",{className:"material-icons md-30",children:"call"})}),Object(x.jsx)("button",{className:"btn option call-end",onClick:function(){K()},children:Object(x.jsx)("i",{className:"material-icons md-30",children:"call_end"})}),Object(x.jsxs)("button",{className:"btn option relative",children:[Object(x.jsx)("i",{className:"material-icons md-30",onClick:function(){return M(!D)},children:"volume_up"}),D&&Object(x.jsx)(be,{setVolume:function(e){r.current&&(r.current.volume=Number(e.target.value)/100)}})]})]})})]})},fe=function(){var e=E(),t=Object(l.a)(e,2),n=t[0],c=(t[1],Object(o.b)()),s=Object(a.useRef)(),r=Object(o.c)((function(e){return e.call})),i=r.isCalling,d=(r.conversation,Object(o.c)((function(e){return e.conversations})).conversations);return Object(a.useEffect)((function(){s.current=d}),[d]),Object(a.useEffect)((function(){n&&n.addEventListener("message",(function(e){var t=e.data;try{t=JSON.parse(t)}catch(a){t=t}if("incomming-call"===t.type){var n=s.current.find((function(e){return e._id===t.payload.conversationId}));c(J(n)),c(z(!0))}}))}),[n,c]),i?Object(x.jsx)(me,{}):null},pe=function(){return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(oe,{}),Object(x.jsx)(Q,{}),Object(x.jsx)(fe,{})]})};p.a.defaults.baseURL="https://demo-clb-123.herokuapp.com/api/v1";var he=Object(m.b)("me/getMe",Object(b.a)(j.a.mark((function e(){var t,n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.get("/auth/me",{withCredentials:!0});case 2:return t=e.sent,n=t.data.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))),Oe=Object(m.c)({name:"me",initialState:{me:null,loading:!0},extraReducers:Object(d.a)({},he.fulfilled,(function(e,t){e.loading=!1,e.me=t.payload}))}).reducer;var ve=function(){var e=Object(o.c)((function(e){return e.auth})).hasToken,t=Object(o.c)((function(e){return e.me})),n=t.loading,c=t.me,s=Object(o.b)();return Object(a.useEffect)((function(){e&&s(he())}),[s,e]),n&&e?"...":Object(x.jsx)("main",{children:Object(x.jsx)("div",{className:"layout",children:c?Object(x.jsxs)(w,{children:[" ",Object(x.jsx)(pe,{})]}):Object(x.jsx)(y,{})})})},xe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,82)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),c(e),a(e),s(e),r(e)}))},ge=(n(79),n(80),n(20)),Ne=Object(ge.b)({auth:v,conversations:se,chat:M,me:Oe,call:K}),ye=function(e,t){return"LOGOUT"===t.type&&(e=void 0),Ne(e,t)},ke=Object(m.a)({reducer:ye});i.a.render(Object(x.jsx)(o.a,{store:ke,children:Object(x.jsx)(s.a.StrictMode,{children:Object(x.jsx)(ve,{})})}),document.getElementById("root")),xe()}},[[81,1,2]]]);
//# sourceMappingURL=main.70e9399a.chunk.js.map