(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{78:function(e,t,n){},79:function(e,t,n){},80:function(e,t,n){"use strict";n.r(t);var c,a=n(0),r=n.n(a),i=n(28),s=n.n(i),o=n(5),l=n(12),d=n(17),u=n(4),j=n.n(u),b=n(13),m=n(11),f=n(16),p=n.n(f);p.a.defaults.baseURL="https://demo-clb-123.herokuapp.com/api/v1";var h=Object(m.b)("auth/signup",function(){var e=Object(b.a)(j.a.mark((function e(t){var n,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.post("/auth/signup",t,{withCredentials:!0});case 2:return n=e.sent,c=n.data.success,e.abrupt("return",c);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),O=Object(m.b)("auth/signin",function(){var e=Object(b.a)(j.a.mark((function e(t){var n,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.post("/auth/signin",t,{withCredentials:!0});case 2:return n=e.sent,c=n.data.success,e.abrupt("return",c);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var v=Object(m.c)({name:"auth",initialState:{loading:!0,isAuth:!1,hasToken:function(){console.log("check token");var e={},t=document.cookie;return t&&t.split(";").forEach((function(t){var n=t.split("=");e[n.shift().trim()]=n.join("=")})),!!e.token}()},reducers:{},extraReducers:(c={},Object(d.a)(c,h.fulfilled,(function(e,t){e.loading=!1,e.hasToken=t.payload})),Object(d.a)(c,O.fulfilled,(function(e,t){e.loading=!1,e.hasToken=t.payload})),c)}).reducer,x=n(1),g=function(e){var t=e.changeToSignup,n=Object(o.b)();return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("div",{className:"main order-md-1",children:Object(x.jsx)("div",{className:"start",children:Object(x.jsx)("div",{className:"container",children:Object(x.jsx)("div",{className:"col-md-12",children:Object(x.jsxs)("div",{className:"content",children:[Object(x.jsx)("h1",{children:"Sign in to Swipe"}),Object(x.jsx)("p",{children:"use your email account:"}),Object(x.jsxs)("form",{onSubmit:function(e){e.preventDefault(),n(O({email:e.target.email.value,password:e.target.password.value}))},children:[Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsx)("input",{type:"email",id:"inputEmail",className:"form-control",name:"email",placeholder:"Email Address",required:!0}),Object(x.jsx)("button",{className:"btn icon",children:Object(x.jsx)("i",{className:"material-icons",children:"mail_outline"})})]}),Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsx)("input",{type:"password",id:"inputPassword",className:"form-control",name:"password",placeholder:"Password",required:!0}),Object(x.jsx)("button",{className:"btn icon",children:Object(x.jsx)("i",{className:"material-icons",children:"lock_outline"})})]}),Object(x.jsx)("button",{type:"submit",className:"btn button",children:"Sign In"}),Object(x.jsx)("div",{className:"callout",children:Object(x.jsxs)("span",{children:["Don't have account? ",Object(x.jsx)("a",{href:"sign-up.html",children:"Create Account"})]})})]})]})})})})}),Object(x.jsx)("div",{className:"aside order-md-2",children:Object(x.jsx)("div",{className:"container",children:Object(x.jsx)("div",{className:"col-md-12",children:Object(x.jsxs)("div",{className:"preference",children:[Object(x.jsx)("h2",{children:"Hello, Friend!"}),Object(x.jsx)("p",{children:"Enter your personal details and start your journey with Swipe today."}),Object(x.jsx)("button",{onClick:t,className:"btn button",children:"Sign Up"})]})})})})]})},N=function(e){var t=e.changeToSignin,n=Object(o.b)();return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("div",{className:"main order-md-2",children:Object(x.jsx)("div",{className:"start",children:Object(x.jsx)("div",{className:"container",children:Object(x.jsx)("div",{className:"col-md-12",children:Object(x.jsxs)("div",{className:"content",children:[Object(x.jsx)("h1",{children:"Create Account"}),Object(x.jsx)("p",{children:"use your email for registration:"}),Object(x.jsxs)("form",{className:"signup",onSubmit:function(e){e.preventDefault(),n(h({email:e.target.email.value,password:e.target.password.value,fullname:e.target.fullname.value}))},children:[Object(x.jsxs)("div",{className:"form-parent",children:[Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsx)("input",{type:"text",id:"inputName",className:"form-control",name:"fullname",placeholder:"Username",required:!0}),Object(x.jsx)("button",{className:"btn icon",children:Object(x.jsx)("i",{className:"material-icons",children:"person_outline"})})]}),Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsx)("input",{type:"email",id:"inputEmail",className:"form-control",name:"email",placeholder:"Email Address",required:!0}),Object(x.jsx)("button",{className:"btn icon",children:Object(x.jsx)("i",{className:"material-icons",children:"mail_outline"})})]})]}),Object(x.jsxs)("div",{className:"form-group",children:[Object(x.jsx)("input",{type:"password",id:"inputPassword",className:"form-control",name:"password",placeholder:"Password",required:!0}),Object(x.jsx)("button",{className:"btn icon",children:Object(x.jsx)("i",{className:"material-icons",children:"lock_outline"})})]}),Object(x.jsx)("button",{type:"submit",className:"btn button",children:"Sign Up"}),Object(x.jsx)("div",{className:"callout",children:Object(x.jsxs)("span",{children:["Already a member? ",Object(x.jsx)("a",{href:"sign-in.html",children:"Sign In"})]})})]})]})})})})}),Object(x.jsx)("div",{className:"aside order-md-1",children:Object(x.jsx)("div",{className:"container",children:Object(x.jsx)("div",{className:"col-md-12",children:Object(x.jsxs)("div",{className:"preference",children:[Object(x.jsx)("h2",{children:"Welcome Back!"}),Object(x.jsx)("p",{children:"To keep connected with your friends please login with your personal info."}),Object(x.jsx)("button",{onClick:t,className:"btn button",children:"Sign In"})]})})})})]})},y=function(){var e=Object(a.useState)("signin"),t=Object(l.a)(e,2),n=t[0],c=t[1];return Object(x.jsx)(x.Fragment,{children:"signin"===n?Object(x.jsx)(g,{changeToSignup:function(){return c("signup")}}):Object(x.jsx)(N,{changeToSignin:function(){return c("signin")}})})},w=Object(a.createContext)(null),k=function(e){var t=e.children,n=Object(a.useState)(null),c=Object(l.a)(n,2),r=c[0],i=c[1];return Object(a.useEffect)((function(){try{var e=new WebSocket("wss://demo-clb-123.herokuapp.com");i(e)}catch(t){console.log(t)}}),[]),Object(x.jsx)(w.Provider,{value:r,children:t})},C=n(47),_=n(18),S=n(19),E=function(){var e=Object(a.useContext)(w);if(void 0===e)throw new Error("faillllllllllllll websocket");return[e,function(e,t){return JSON.stringify({type:e,payload:t})}]};p.a.defaults.baseURL="https://demo-clb-123.herokuapp.com/api/v1";var T,I,D=Object(m.b)("chat/messages",function(){var e=Object(b.a)(j.a.mark((function e(t){var n,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.get("/conversation/".concat(t,"/message"),{withCredentials:!0});case 2:return n=e.sent,c=n.data.messages,e.abrupt("return",{key:t,value:c});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),L=Object(m.c)({name:"chat",initialState:{isLoading:!0,chats:{}},reducers:{addMessage:function(e,t){var n;null===(n=e.chats[t.payload.conversationId])||void 0===n||n.push(t.payload)}},extraReducers:Object(d.a)({},D.fulfilled,(function(e,t){e.isLoading=!1,e.chats[t.payload.key]=t.payload.value}))}),R=L.actions.addMessage,A=L.reducer,M=function(e){var t=e.user;return Object(x.jsxs)("div",{className:"message",children:[Object(x.jsx)("img",{className:"avatar-md",src:t.avatar,"data-toggle":"tooltip","data-placement":"top",title:"Keith",alt:"avatar"}),Object(x.jsx)("div",{className:"text-main",children:Object(x.jsx)("div",{className:"text-group",children:Object(x.jsx)("div",{className:"text typing",children:Object(x.jsxs)("div",{className:"wave",children:[Object(x.jsx)("span",{className:"dot"}),Object(x.jsx)("span",{className:"dot"}),Object(x.jsx)("span",{className:"dot"})]})})})})]})},F=function(e){var t=e.message,n=new Date(t.createdAt);return Object(x.jsxs)("div",{className:"message ".concat(t.isMine?"me":""),children:[t.isMine?"":Object(x.jsx)("img",{className:"avatar-md",src:t.senderId.avatar,"data-toggle":"tooltip","data-placement":"top",title:"Keith",alt:"avatar"}),Object(x.jsxs)("div",{className:"text-main",children:[Object(x.jsx)("div",{className:"text-group ".concat(t.isMine?"me":""),children:Object(x.jsx)("div",{className:"text ".concat(t.isMine?"me":""),children:Object(x.jsx)("p",{children:t.message})})}),Object(x.jsx)("span",{children:"".concat(n.getHours(),":").concat(n.getMinutes())})]})]})},P=Object(m.c)({name:"call",initialState:{conversation:null,isCalling:!1,incommingCall:!1,callAway:!1},reducers:{setConversation:function(e,t){e.conversation=t.payload,e.isCalling=!0},setIncommingCall:function(e,t){e.incommingCall=!0,e.isCalling=!0},setCallAway:function(e,t){e.callAway=!0,e.isCalling=!0},setIsCallingToFalse:function(e,t){e.isCalling=e.incommingCall=e.callAway=!1,e.conversation=null}}}),U=P.actions,J=U.setConversation,z=U.setIncommingCall,V=U.setCallAway,q=U.setIsCallingToFalse,B=P.reducer,K=n(42),W=n(46),G=(n(77),S.a.div(T||(T=Object(_.a)(["\n  position: relative;\n\n  .emoji__picker--toggle {\n  }\n  .emoji__picker--content {\n    display: none;\n  }\n  .active {\n    display: block;\n  }\n  @media (max-width: 425px) {\n    .emoji-mart {\n      width: 280px !important;\n    }\n  }\n\n"])))),H=r.a.forwardRef((function(e,t){var n=e.setValue,c=e.pickerStyle,r=Object(a.useRef)(null);Object(a.useEffect)((function(){!function(e,t){document.addEventListener("mousedown",(function(n){t.current&&t.current.contains(n.target)?e.current.classList.toggle("active"):e.current&&!e.current.contains(n.target)&&e.current.classList.remove("active")}))}(r,t)}),[t]);return Object(x.jsxs)(G,{children:[Object(x.jsx)("div",{ref:t,className:"emoji__picker--toggle",children:Object(x.jsx)("i",{className:"material-icons",style:{padding:"14px"},children:"insert_emoticon"})}),Object(x.jsx)("div",{ref:r,className:"emoji__picker--content",children:Object(x.jsx)(W.a,{set:"apple",style:Object(K.a)({position:"absolute",zIndex:"9"},c),onSelect:function(e){n((function(t){return t+e.native}))}})})]})})),Q=(S.a.div(I||(I=Object(_.a)(["\n    position: fixed;\n    /* width: 200px;\n    height: 200px; */\n    z-index:9999999;\n    background:linear-gradient(145deg,rgba(140,167,255,1) 0,rgba(139,84,249,1) 50%,rgba(131,33,243,1) 100%);\n"]))),function(){var e,t=Object(o.c)((function(e){return e.chat})),n=t.isLoading,c=t.chats,r=Object(o.c)((function(e){return e.conversations})).currentConversation,i=Object(a.useState)(""),s=Object(l.a)(i,2),d=s[0],u=s[1],j=Object(a.useState)([]),b=Object(l.a)(j,2),m=b[0],f=b[1],p=Object(o.c)((function(e){return e.call})).isCalling,h=E(),O=Object(l.a)(h,2),v=O[0],g=O[1],N=Object(o.b)(),y=Object(a.useRef)(""),w=Object(a.useRef)(),k=Object(a.useRef)(),_=Object(a.useRef)();Object(a.useEffect)((function(){""===y.current&&""!==d&&v.send(g("start-typing",{conversationId:r._id})),""===d&&""!==y.current&&v.send(g("end-typing",{conversationId:r._id})),y.current!==d&&(y.current=d)}),[r._id,d,v,g]),Object(a.useEffect)((function(){return function(){d&&(u(""),v&&v.send(g("end-typing",{conversationId:r._id})))}}),[r._id]),Object(a.useEffect)((function(){v&&v.addEventListener("message",(function(e){var t=e.data;if((t=JSON.parse(t)).conversationId===r._id)switch(t.type){case"start-typing":f((function(e){return[].concat(Object(C.a)(e),[t.payload.user])}));break;case"end-typing":f((function(e){return e.filter((function(e){return e._id!==t.payload.user._id}))}));break;default:return}}))}),[v,r._id]),Object(a.useEffect)((function(){w.current&&(w.current.scrollTop=k.current.offsetHeight)}),[c]),Object(a.useEffect)((function(){!c[r._id]&&r._id&&N(D(r._id))}),[c,r._id,N]);var S=function(e){if(d.trim()){u("");var t={type:"text",message:d,conversationId:r._id,createdAt:(new Date).toISOString()};v.send(g("new-message",t)),t.isMine=!0,N(R(t))}};return!c[r._id]||n?null:Object(x.jsx)(x.Fragment,{children:Object(x.jsx)("div",{className:"main",children:Object(x.jsx)("div",{className:"tab-content",id:"nav-tabContent",children:Object(x.jsx)("div",{className:"babble tab-pane fade active show",id:"list-chat",role:"tabpanel","aria-labelledby":"list-chat-list",children:Object(x.jsxs)("div",{className:"chat",id:"chat1",children:[Object(x.jsx)("div",{className:"top",children:Object(x.jsx)("div",{className:"container",children:Object(x.jsx)("div",{className:"col-md-12",children:Object(x.jsxs)("div",{className:"inside",children:[Object(x.jsx)("a",{href:"/",onClick:function(e){return e.preventDefault()},children:Object(x.jsx)("img",{className:"avatar-md",src:r.avatar,"data-toggle":"tooltip","data-placement":"top",title:"Keith",alt:"avatar"})}),Object(x.jsx)("div",{className:"status",children:Object(x.jsx)("i",{className:"material-icons online",children:"fiber_manual_record"})}),Object(x.jsxs)("div",{className:"data",children:[Object(x.jsx)("h5",{children:Object(x.jsx)("a",{href:"/",onClick:function(e){return e.preventDefault()},children:r.title})}),Object(x.jsx)("span",{children:"Active now"})]}),Object(x.jsx)("button",{className:"btn connect d-md-block d-none",name:1,onClick:function(){p||(N(V(!0)),N(J(r)))},children:Object(x.jsx)("i",{className:"material-icons md-36",children:"videocam"})})]})})})}),Object(x.jsx)("div",{ref:w,className:"content",id:"content",children:Object(x.jsx)("div",{ref:k,className:"container",children:Object(x.jsxs)("div",{className:"col-md-12",children:[null===(e=c[r._id])||void 0===e?void 0:e.map((function(e,t){return Object(x.jsx)(F,{message:e},e._id||t)})),null===m||void 0===m?void 0:m.map((function(e,t){return Object(x.jsx)(M,{user:e},t)}))]})})}),Object(x.jsx)("div",{className:"container",children:Object(x.jsx)("div",{className:"col-md-12",children:Object(x.jsx)("div",{className:"bottom",children:Object(x.jsxs)("form",{className:"position-relative w-100",children:[Object(x.jsx)("textarea",{className:"form-control",placeholder:"Start typing for reply...",rows:1,value:d,onChange:function(e){return u(e.target.value)},onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),S())}}),Object(x.jsx)("div",{style:{padding:0},className:"btn emoticons",onClick:function(e){e.preventDefault(),_.current.dispatchEvent(new Event("mousedown"))},children:Object(x.jsx)(H,{ref:_,setValue:u,pickerStyle:{left:0,bottom:"50px"}})}),Object(x.jsx)("button",{type:"button",className:"btn send",onClick:S,children:Object(x.jsx)("i",{className:"material-icons",children:"send"})})]})})})})]})})})})})});p.a.defaults.baseURL="https://demo-clb-123.herokuapp.com/api/v1";var X,Y,Z,$,ee=Object(m.b)("conversations/list",Object(b.a)(j.a.mark((function e(){var t,n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.get("/conversation",{withCredentials:!0});case 2:return t=e.sent,n=t.data.conversations,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))),te=Object(m.c)({name:"conversations",initialState:{isLoading:!0,currentConversation:"",conversations:[]},reducers:{chooseConversation:function(e,t){e.currentConversation=e.conversations.find((function(e){return e._id===t.payload}))},setLastMessage:function(e,t){e.conversations.forEach((function(e){e._id===t.payload.conversationId&&(e.lastMessageId=t.payload)}))}},extraReducers:Object(d.a)({},ee.fulfilled,(function(e,t){e.isLoading=!1,e.conversations=t.payload}))}),ne=te.actions,ce=ne.chooseConversation,ae=ne.setLastMessage,re=te.reducer,ie=(S.a.div(X||(X=Object(_.a)(["\n    height: 80px;\n    width:100%;\n"]))),["Mon","Tue","Wed","Thurs","Fri","Sat","Sun"]),se=function(e){var t=e.cvs,n=Object(o.b)();return Object(x.jsxs)("a",{onClick:function(e){e.preventDefault(),n(D(t._id)),n(ce(t._id))},href:"#list-chat",className:"filterDiscussions all unread single active",id:"list-chat-list","data-toggle":"list",role:"tab",children:[Object(x.jsx)("img",{className:"avatar-md",src:t.avatar,"data-toggle":"tooltip","data-placement":"top",title:"Janette",alt:"avatar"}),Object(x.jsx)("div",{className:"status",children:Object(x.jsx)("i",{className:"material-icons online",children:"fiber_manual_record"})}),Object(x.jsxs)("div",{className:"data",children:[Object(x.jsx)("h5",{children:t.title}),Object(x.jsx)("span",{children:ie[new Date(t.lastMessageId.createdAt).getDay()]}),Object(x.jsx)("p",{children:t.lastMessageId.message})]})]})},oe=(S.a.div(Y||(Y=Object(_.a)(["\n    border: 1px solid black;\n"]))),function(){var e=Object(o.c)((function(e){return e.conversations})),t=e.isLoading,n=e.conversations,c=Object(o.b)(),r=E(),i=Object(l.a)(r,2),s=i[0];i[1];Object(a.useEffect)((function(){s&&s.addEventListener("message",(function(e){var t=e.data;"new-message"===(t=JSON.parse(t)).type&&(c(ae(t.payload.message)),t.payload.message.isMine||c(R(t.payload.message)))}))}),[s,c]),Object(a.useEffect)((function(){c(ee())}),[c]);return t?"...loading":Object(x.jsx)(x.Fragment,{children:Object(x.jsx)("div",{className:"sidebar",id:"sidebar",children:Object(x.jsx)("div",{className:"container",children:Object(x.jsx)("div",{className:"col-md-12",children:Object(x.jsx)("div",{className:"tab-content",children:Object(x.jsx)("div",{id:"discussions",className:"tab-pane fade active show",children:Object(x.jsxs)("div",{className:"discussions",children:[Object(x.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[Object(x.jsx)("h1",{children:"Discussions"}),Object(x.jsx)("button",{className:"btn btn-outline-danger",onClick:function(){document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",c({type:"LOGOUT"})},children:Object(x.jsx)("i",{className:"material-icons md-30",children:"power_settings_new"})})]}),Object(x.jsx)("div",{className:"list-group",id:"chats",role:"tablist",children:null===n||void 0===n?void 0:n.map((function(e){return Object(x.jsx)(se,{cvs:e},e._id)}))})]})})})})})})})}),le=S.a.div(Z||(Z=Object(_.a)(["\n    position: fixed;\n    width: 390px;\n    height: 300px;\n    z-index: 9999999;\n    top: 100px;\n\n    right: 0;\n\n    background-color: aliceblue;\n    filter: white;\n    .hover__inner {\n        opacity: 0;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n    }\n    .call-end {\n        color: red;\n    }\n    .pick-up {\n        color: green;\n    }\n    :hover .hover__inner {\n        position: absolute;\n        width: 390px;\n        height: 300px;\n        z-index: 99999999;\n        opacity: 1;\n    }\n    .relative {\n        position: relative;\n    }\n\n    #local__video {\n        position: absolute;\n        width: 130px;\n        height: 100px;\n        /* border: 1px solid black; */\n        z-index: 99999990;\n    }\n    #remote__video {\n        position: absolute;\n        width: 390px;\n        height: 300px;\n        /* border: 1px solid black; */\n        /* z-index: 99999999; */\n    }\n"]))),de=S.a.div($||($=Object(_.a)(["\n    position: absolute;\n    display: flex;\n    left: -50px;\n"]))),ue=function(e){var t=e.setVolume;return Object(x.jsxs)(de,{children:[Object(x.jsx)("i",{className:"material-icons md-30",children:"volume_down"}),Object(x.jsx)("input",{type:"range",min:"0",max:"100",defaultValue:"100",id:"myRange",onChange:t}),Object(x.jsx)("i",{className:"material-icons md-30",children:"volume_up"})]})},je=function(){var e=E(),t=Object(l.a)(e,2),n=t[0],c=t[1],r=Object(a.useRef)(),i=Object(a.useRef)(),s=Object(a.useRef)(null),d=Object(a.useRef)(null),u=Object(o.c)((function(e){return e.call})),m=u.conversation,f=u.incommingCall,p=u.callAway,h=Object(a.useState)(!0),O=Object(l.a)(h,2),v=O[0],g=O[1],N=Object(o.b)(),y=Object(a.useState)(!0),w=Object(l.a)(y,2),k=w[0],C=w[1],_=Object(a.useState)(!0),S=Object(l.a)(_,2),T=S[0],I=S[1],D=Object(a.useState)(!1),L=Object(l.a)(D,2),R=L[0],A=L[1],M=Object(a.useRef)(!1);function F(){return P.apply(this,arguments)}function P(){return(P=Object(b.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={iceServers:[{url:"stun:stun2.1.google.com:19302"}]},s.current=new RTCPeerConnection(t),s.current.onicecandidate=W,s.current.oniceconnectionstatechange=H,s.current.onicegatheringstatechange=X,s.current.onsignalingstatechange=Q,s.current.onnegotiationneeded=Y,s.current.ontrack=$;case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(a.useEffect)((function(){var e=function(e){var t=e.data;try{t=JSON.parse(t)}catch(n){ee(n)}switch(t.type){case"offer":U(t.payload.offer);break;case"answer":J(t.payload.answer);break;case"candidate":V(t.payload.candidate);break;case"leave":z()}};return n&&n.addEventListener("message",e),function(){n.removeEventListener("message",e)}}),[n]),Object(a.useEffect)((function(){if(p){K({audio:!0,video:!0})}}),[p]),Object(a.useEffect)((function(){p&&(ee("make calll"),n.send(c("make-call",{conversationId:m._id})))}),[n,c,p,m]);var U=function(){var e=Object(b.a)(j.a.mark((function e(t){var a,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,ee("---\x3e Creating peer"),console.log(s.current),s.current){e.next=6;break}return e.next=6,F();case 6:if(a=new RTCSessionDescription(t),"stable"===s.current.signalingState){e.next=14;break}return ee("  - But the signaling state isn't stable, so triggering rollback"),e.next=11,Promise.all([s.current.setLocalDescription({type:"rollback"}),s.current.setRemoteDescription(a)]);case 11:return e.abrupt("return");case 14:return ee("  - Setting remote description"),e.next=17,s.current.setRemoteDescription(a);case 17:if(console.log("--------------------------------",i.current.srcObject),!M.current)try{ee("add track"),M.current=!0,d.current.getTracks().forEach((function(e){return s.current.addTransceiver(e,{streams:[d.current]})}))}catch(o){ee(o)}return ee("---\x3e Creating and sending answer to caller"),e.t0=s.current,e.next=23,s.current.createAnswer();case 23:return e.t1=e.sent,e.next=26,e.t0.setLocalDescription.call(e.t0,e.t1);case 26:ee("---\x3e Sending the answer to the remote peer"),r=c("answer",{conversationId:m._id,answer:s.current.localDescription}),n.send(r),e.next=34;break;case 31:e.prev=31,e.t2=e.catch(0),ee(e.t2);case 34:case"end":return e.stop()}}),e,null,[[0,31]])})));return function(t){return e.apply(this,arguments)}}(),J=function(){var e=Object(b.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.current.setRemoteDescription(new RTCSessionDescription(t));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),z=function(){console.log(" leaveeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"),N(q()),G()},V=function(){var e=Object(b.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!s.current.remoteDescription){e.next=4;break}return ee("add candidate"),e.next=4,s.current.addIceCandidate(t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),B=function(){var e=Object(b.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ee("pick up"),g(!1),e.next=4,F();case 4:return e.prev=4,e.next=7,K({video:!0,audio:!0});case 7:ee("add track"),d.current.getTracks().forEach((function(e){return s.current.addTransceiver(e,{streams:[d.current]})})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),ee(e.t0);case 14:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=Object(b.a)(j.a.mark((function e(t){var n,c,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.video,c=t.audio,e.next=3,navigator.mediaDevices.getUserMedia({video:n,audio:c});case 3:a=e.sent,d.current=a,r.current?r.current.srcObject=a:d.current.getTracks().forEach((function(e){return e.stop()}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),W=function(e){e.candidate&&(ee("*** Outgoing ICE candidate: "+e.candidate.candidate),n.send(c("candidate",{conversationId:m._id,candidate:e.candidate})))};function G(){ee("Closing the call"),N(q()),s.current&&(ee("--\x3e Closing the peer connection"),s.current.ontrack=null,s.current.onnicecandidate=null,s.current.oniceconnectionstatechange=null,s.current.onsignalingstatechange=null,s.current.onicegatheringstatechange=null,s.current.onnotificationneeded=null,s.current.getTransceivers().forEach((function(e){e.stop()})),d.current&&d.current.getTracks().forEach((function(e){e.stop()})),s.current.close(),s.current=null,d.current=null)}function H(e){switch(ee("*** ICE connection state changed to "+s.current.iceConnectionState),s.current.iceConnectionState){case"closed":case"failed":case"disconnected":G();break;default:return}}function Q(e){ee("*** WebRTC signaling state changed to: "+s.current.signalingState),"closed"===s.current.signalingState&&G()}function X(e){ee("*** ICE gathering state changed to: "+s.current.iceGatheringState)}function Y(){return Z.apply(this,arguments)}function Z(){return(Z=Object(b.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ee("*** Negotiation needed"),e.prev=1,e.next=4,s.current.createOffer();case 4:if(t=e.sent,"stable"===s.current.signalingState){e.next=8;break}return ee("     -- The connection isn't stable yet; postponing..."),e.abrupt("return");case 8:return ee("---\x3e Setting local description to the offer"),e.next=11,s.current.setLocalDescription(t);case 11:ee("---\x3e Sending the offer to the remote peer"),n.send(c("offer",{offer:s.current.localDescription,conversationId:m._id})),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(1),ee("*** The following error occurred while handling the negotiationneeded event:"),ee(e.t0);case 19:case"end":return e.stop()}}),e,null,[[1,15]])})))).apply(this,arguments)}function $(e){ee("*** Track event"),i.current.srcObject=e.streams[0]}function ee(e){var t=new Date;console.log("["+t.toLocaleTimeString()+"] "+e)}return Object(x.jsxs)(le,{children:[Object(x.jsx)("video",{ref:r,autoPlay:!0,id:"local__video",muted:!0}),Object(x.jsx)("video",{ref:i,autoPlay:!0,id:"remote__video"}),Object(x.jsx)("div",{className:"hover__inner",children:Object(x.jsxs)("div",{className:"options",children:[Object(x.jsx)("button",{className:"btn option",onClick:function(){d.current&&(d.current.getAudioTracks().forEach((function(e){return e.enabled=!k})),C(!k))},children:k?Object(x.jsx)("i",{className:"material-icons md-30",children:"mic"}):Object(x.jsx)("i",{className:"material-icons md-30",children:"mic_off"})}),Object(x.jsx)("button",{className:"btn option",onClick:function(){d.current&&(d.current.getVideoTracks().forEach((function(e){return e.enabled=!T})),I(!T))},children:T?Object(x.jsx)("i",{className:"material-icons md-30",children:"videocam"}):Object(x.jsx)("i",{className:"material-icons md-30",children:"videocam_off"})}),f&&v&&Object(x.jsx)("button",{className:"btn pick-up",onClick:B,children:Object(x.jsx)("i",{className:"material-icons md-30",children:"call"})}),Object(x.jsx)("button",{className:"btn option call-end",onClick:function(){N(q()),n.send(c("leave",{conversationId:m._id})),G()},children:Object(x.jsx)("i",{className:"material-icons md-30",children:"call_end"})}),Object(x.jsxs)("button",{className:"btn option relative",children:[Object(x.jsx)("i",{className:"material-icons md-30",onClick:function(){return A(!R)},children:"volume_up"}),R&&Object(x.jsx)(ue,{setVolume:function(e){i.current&&(i.current.volume=Number(e.target.value)/100)}})]})]})})]})},be=function(){var e=E(),t=Object(l.a)(e,2),n=t[0],c=(t[1],Object(o.b)()),r=Object(a.useRef)(),i=Object(o.c)((function(e){return e.call})),s=i.isCalling,d=(i.conversation,Object(o.c)((function(e){return e.conversations})).conversations);return Object(a.useEffect)((function(){r.current=d}),[d]),Object(a.useEffect)((function(){n&&n.addEventListener("message",(function(e){var t=e.data;try{t=JSON.parse(t)}catch(a){t=t}if("incomming-call"===t.type){var n=r.current.find((function(e){return e._id===t.payload.conversationId}));c(J(n)),c(z(!0))}}))}),[n,c]),s?Object(x.jsx)(je,{}):null},me=function(){return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(oe,{}),Object(x.jsx)(Q,{}),Object(x.jsx)(be,{})]})};p.a.defaults.baseURL="https://demo-clb-123.herokuapp.com/api/v1";var fe=Object(m.b)("me/getMe",Object(b.a)(j.a.mark((function e(){var t,n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.get("/auth/me",{withCredentials:!0});case 2:return t=e.sent,n=t.data.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))),pe=Object(m.c)({name:"me",initialState:{me:null,loading:!0},extraReducers:Object(d.a)({},fe.fulfilled,(function(e,t){e.loading=!1,e.me=t.payload}))}).reducer;var he=function(){var e=Object(o.c)((function(e){return e.auth})).hasToken,t=Object(o.c)((function(e){return e.me})),n=t.loading,c=t.me,r=Object(o.b)();return Object(a.useEffect)((function(){e&&r(fe())}),[r,e]),n&&e?"...":Object(x.jsx)("main",{children:Object(x.jsx)("div",{className:"layout",children:c?Object(x.jsxs)(k,{children:[" ",Object(x.jsx)(me,{})]}):Object(x.jsx)(y,{})})})},Oe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,81)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),c(e),a(e),r(e),i(e)}))},ve=(n(78),n(79),n(20)),xe=Object(ve.b)({auth:v,conversations:re,chat:A,me:pe,call:B}),ge=function(e,t){return"LOGOUT"===t.type&&(e=void 0),xe(e,t)},Ne=Object(m.a)({reducer:ge});s.a.render(Object(x.jsx)(o.a,{store:Ne,children:Object(x.jsx)(r.a.StrictMode,{children:Object(x.jsx)(he,{})})}),document.getElementById("root")),Oe()}},[[80,1,2]]]);
//# sourceMappingURL=main.9e2041d0.chunk.js.map